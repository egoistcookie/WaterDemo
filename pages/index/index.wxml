<view class="container">
  <!-- 短链解析区域 -->
  <view class="card">
    <view class="section-title">解析链接，获取图片</view>
    <input 
      class="input"
      placeholder="输入小红书短链或豆包链接"
      value="{{shortLink}}"
      bindinput="onShortLinkInput"
      confirm-type="done"
    />
    <button 
      class="btn"
      bindtap="parseShortLink"
      loading="{{isParsing}}"
      disabled="{{isParsing || !shortLink}}"
    >
      {{isParsing ? '解析中...' : '解析短链'}}
    </button>

    <view class="result-url" wx:if="{{parsedMediaUrl}}">
      <text selectable="true" user-select="true" space="true">{{parsedMediaUrl}}</text>
    </view>

    <view class="log-panel" wx:if="{{logs.length}}">
      <view class="log-item" wx:for="{{logs}}" wx:key="index">
        {{item}}
      </view>
    </view>
  </view>

  <!-- 图片预览区域 -->
  <view class="result-container" wx:if="{{allImages.length > 0}}">
    <view class="section-title">无水印原图预览（共{{allImages.length}}张）</view>
    
    <!-- 操作栏 -->
    <view class="action-bar">
      <button class="btn-small" bindtap="toggleSelectAll">
        {{selectedImages.length === allImages.length ? '取消全选' : '全选'}}
      </button>
      <button 
        class="btn-primary" 
        bindtap="downloadSelectedImages"
        disabled="{{selectedImages.length === 0}}"
      >
        下载选中({{selectedImages.length}})
      </button>
    </view>

    <!-- 图片列表 -->
    <view class="image-list">
      <view 
        class="image-item {{item.selected ? 'selected' : ''}}"
        wx:for="{{allImages}}" 
        wx:key="index"
        data-index="{{index}}"
        bindtap="toggleImageSelect"
      >
        <view class="image-checkbox">
          <text class="checkbox-icon" wx:if="{{item.selected}}">✓</text>
        </view>
        <image class="image-thumb" src="{{item.url}}" mode="aspectFill" lazy-load="true"></image>
        <view class="image-actions">
          <button class="btn-mini" catchtap="downloadImage" data-index="{{index}}">下载</button>
        </view>
      </view>
    </view>
  </view>

  <!-- 空状态提示 -->
  <view class="empty-tip" wx:if="{{allImages.length === 0}}">
    <text>请输入小红书短链，解析后即可查看无水印原图</text>
  </view>
</view>
